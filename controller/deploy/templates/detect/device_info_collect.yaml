# 设备信息采集配置
# 定义如何从设备采集识别信息

name: deviceInfoCollect
timeout: 30s
retries: 2

strategies:
  # 策略1: SNMP优先（网络设备）
  - name: snmpFirst
    priority: 1
    conditions:
      - protocol: SNMP
        available: true
    collect:
      # SNMP sysDescr 和 sysName - 使用父OID批量采集
      - name: sysInfo
        type: Collect
        method: SNMP
        target: 1.3.6.1.2.1.1  # 父OID
        timeout: 10s
        output: sysDescr,sysName  # 多个输出字段，用逗号分隔
        required: true
        # SNMP特定配置
        snmpConfig:
          indexPositions: [1]
          classifierPositions: [0]
          prefixMap:
            "1": sysDescr
            "5": sysName
  
  # 策略2: SSH优先（服务器或网络设备）
  - name: sshFirst
    priority: 2
    conditions:
      - protocol: SSH
        available: true
    collect:
      # Linux服务器 - OS Release信息
      - name: osRelease
        type: Collect
        method: SSH
        target: "cat /etc/os-release"
        timeout: 10s
        output: osRelease
        fallback:
          - target: "cat /etc/redhat-release"
          - target: "cat /etc/issue"
      
      # Linux服务器 - 系统信息
      - name: unameInfo
        type: Collect
        method: SSH
        target: "uname -a"
        timeout: 10s
        output: unameInfo
      
      # 网络设备 - 版本信息（Cisco）
      - name: versionInfo
        type: Collect
        method: SSH
        target: "show version"
        timeout: 15s
        output: versionInfo
        fallback:
          # Huawei
          - target: "display version"
          # H3C
          - target: "display version"
          # 其他
          - target: "show ver"
          - target: "version"
      
      # 网络设备 - 系统信息
      - name: systemInfo
        type: Collect
        method: SSH
        target: "show system"
        timeout: 10s
        output: systemInfo
        fallback:
          - target: "display system"
  
  # 策略3: TELNET备选（当SSH不可用时）
  - name: telnetFallback
    priority: 3
    conditions:
      - protocol: TELNET
        available: true
      - protocol: SSH
        available: false
    collect:
      - name: versionInfo
        type: Collect
        method: TELNET
        target: "show version"
        timeout: 15s
        output: versionInfo
        fallback:
          - target: "display version"

